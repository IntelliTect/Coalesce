name: build-alpha

on:
  pull_request:
    branches: [dev, next]
    paths-ignore: ['docs/**']
  workflow_dispatch:

jobs:
  meta:
    uses: ./.github/workflows/part-compute-version.yml
    secrets: inherit
    with:
      prereleaseSlug: ci

  build:
    uses: ./.github/workflows/part-build.yml
    secrets: inherit
    needs: meta
    with:
      COALESCE_VERSION: ${{ needs.meta.outputs.COALESCE_VERSION }}

  publish:
    if: success() && github.event_name == 'push'
    uses: ./.github/workflows/part-publish.yml
    needs: build
    secrets: inherit
