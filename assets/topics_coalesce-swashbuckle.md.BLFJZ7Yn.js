import{_ as s,c as a,o as e,a7 as n}from"./chunks/framework.BkavzUpE.js";const o="/Coalesce/assets/coalesce-swashbuckle-without.C9T1kd2R.jpg",l="/Coalesce/assets/coalesce-swashbuckle-with.CAm134Ta.jpg",g=JSON.parse('{"title":"OpenAPI/Swagger","description":"","frontmatter":{},"headers":[],"relativePath":"topics/coalesce-swashbuckle.md","filePath":"topics/coalesce-swashbuckle.md"}'),t={name:"topics/coalesce-swashbuckle.md"},p=n(`<h1 id="openapi-swagger" tabindex="-1">OpenAPI/Swagger <a class="header-anchor" href="#openapi-swagger" aria-label="Permalink to &quot;OpenAPI/Swagger&quot;">​</a></h1><p>When using Coalesce to generate API endpoints, the default OpenAPI generation <em>(sometimes referred to as its pre-2015 name &quot;Swagger&quot;)</em> can sometimes result in verbose and confusing API definitions, especially when dealing with DataSources and Behaviors. To address these issues, the <code>IntelliTect.Coalesce.Swashbuckle</code> package offers enhancements for OpenAPI definitions, making your Coalesce-generated APIs clearer and more manageable.</p><h2 id="setup" tabindex="-1">Setup <a class="header-anchor" href="#setup" aria-label="Permalink to &quot;Setup&quot;">​</a></h2><p>In this setup process, we&#39;re going to add an additional Coalesce NuGet package, configure OpenAPI in your ASP.NET Core application, and specify a Coalesce-specific config property to improve the OpenAPI documentation for Coalesce-generated APIs.</p><h3 id="_1-add-the-nuget-package" tabindex="-1">1. Add the NuGet Package <a class="header-anchor" href="#_1-add-the-nuget-package" aria-label="Permalink to &quot;1. Add the NuGet Package&quot;">​</a></h3><p>Add a reference to the <code>IntelliTect.Coalesce.Swashbuckle</code> NuGet package to your web project:</p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki dark-plus vp-code"><code><span class="line"><span style="color:#808080;">&lt;</span><span style="color:#569CD6;">ItemGroup</span><span style="color:#808080;">&gt;</span></span>
<span class="line"><span style="color:#808080;">  &lt;</span><span style="color:#569CD6;">PackageReference</span><span style="color:#9CDCFE;"> Include</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;IntelliTect.Coalesce.Vue&quot;</span><span style="color:#9CDCFE;"> Version</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;$(CoalesceVersion)&quot;</span><span style="color:#808080;"> /&gt;</span></span>
<span class="line highlighted"><span style="color:#808080;">  &lt;</span><span style="color:#569CD6;">PackageReference</span><span style="color:#9CDCFE;"> Include</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;IntelliTect.Coalesce.Swashbuckle&quot;</span><span style="color:#9CDCFE;"> Version</span><span style="color:#D4D4D4;">=</span><span style="color:#CE9178;">&quot;$(CoalesceVersion)&quot;</span><span style="color:#808080;"> /&gt;</span></span>
<span class="line"><span style="color:#808080;">&lt;/</span><span style="color:#569CD6;">ItemGroup</span><span style="color:#808080;">&gt;</span></span></code></pre></div><h3 id="configure-openapi-in-program-cs" tabindex="-1">Configure OpenAPI in Program.cs <a class="header-anchor" href="#configure-openapi-in-program-cs" aria-label="Permalink to &quot;Configure OpenAPI in Program.cs&quot;">​</a></h3><p>Update your Program.cs file to configure OpenAPI and include Coalesce-specific enhancements. This involves <a href="https://learn.microsoft.com/en-us/aspnet/core/tutorials/getting-started-with-swashbuckle?view=aspnetcore-8.0&amp;tabs=visual-studio" target="_blank" rel="noreferrer">setting up OpenAPI as usual</a> and then applying the Coalesce configuration (Note: You do not need to install the <code>Swashbuckle.AspNetCore</code> package if you are using the Coalesce one).</p><div class="language-c#"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki dark-plus vp-code"><code><span class="line"><span style="color:#9CDCFE;">builder</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Services</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AddSwaggerGen</span><span style="color:#D4D4D4;">(</span><span style="color:#9CDCFE;">config</span><span style="color:#D4D4D4;"> =&gt;</span></span>
<span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#9CDCFE;">    config</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">SwaggerDoc</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;v1&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#569CD6;">new</span><span style="color:#4EC9B0;"> OpenApiInfo</span><span style="color:#D4D4D4;"> { </span><span style="color:#9CDCFE;">Title</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;My API&quot;</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">Version</span><span style="color:#D4D4D4;"> = </span><span style="color:#CE9178;">&quot;v1&quot;</span><span style="color:#D4D4D4;"> });</span></span>
<span class="line"><span style="color:#9CDCFE;">    config</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">AddCoalesce</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">// Add coalesce specific configuration</span></span>
<span class="line"><span style="color:#D4D4D4;">});</span></span></code></pre></div><div class="language-c#"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki dark-plus vp-code"><code><span class="line"><span style="color:#6A9955;">// Configure the HTTP request pipeline.</span></span>
<span class="line"><span style="color:#C586C0;">if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">app</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">Environment</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">IsDevelopment</span><span style="color:#D4D4D4;">())</span></span>
<span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#9CDCFE;">    app</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">UseSwagger</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#9CDCFE;">    app</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">UseSwaggerUI</span><span style="color:#D4D4D4;">();</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span></code></pre></div><h2 id="improvements" tabindex="-1">Improvements <a class="header-anchor" href="#improvements" aria-label="Permalink to &quot;Improvements&quot;">​</a></h2><h3 id="default-openapi-generation" tabindex="-1">Default OpenAPI Generation <a class="header-anchor" href="#default-openapi-generation" aria-label="Permalink to &quot;Default OpenAPI Generation&quot;">​</a></h3><p>By default, OpenAPI in ASP.NET Core offers a simple way to document APIs. It generates API documentation based on the structure of your controller actions and data models. While this default setup is functional for many scenarios, it may fall short in representing more complex cases, especially when dealing with Coalesce-generated endpoints that include DataSources and Behaviors. These scenarios can lead to verbose and sometimes confusing OpenAPI documentation.</p><h3 id="coalesce-enhancements" tabindex="-1">Coalesce Enhancements <a class="header-anchor" href="#coalesce-enhancements" aria-label="Permalink to &quot;Coalesce Enhancements&quot;">​</a></h3><p>The <code>IntelliTect.Coalesce.Swashbuckle</code> package addresses the limitations of the default OpenAPI generation by providing custom OpenAPI filters. These filters enhance the readability and usability of your OpenAPI documentation for Coalesce-generated APIs.</p><p>The primary effect is an adjustment of parameter definitions to account for Coalesce&#39;s custom model binders that create instances of Data Sources and Behaviors on each request. These parameters will be updated in the OpenAPI document to account for data source parameters, filter parameters, and other model-specific customizations.</p><h2 id="visual-comparison" tabindex="-1">Visual Comparison <a class="header-anchor" href="#visual-comparison" aria-label="Permalink to &quot;Visual Comparison&quot;">​</a></h2><p>To illustrate the impact of the <code>IntelliTect.Coalesce.Swashbuckle</code> package, let&#39;s examine the Patient model and its representation in OpenAPI.</p><div class="language-c#"><button title="Copy Code" class="copy"></button><span class="lang">c#</span><pre class="shiki dark-plus vp-code"><code><span class="line"><span style="color:#569CD6;">public</span><span style="color:#569CD6;"> class</span><span style="color:#4EC9B0;"> Patient</span></span>
<span class="line"><span style="color:#D4D4D4;">{</span></span>
<span class="line"><span style="color:#569CD6;">    public</span><span style="color:#569CD6;"> int</span><span style="color:#9CDCFE;"> PatientId</span><span style="color:#D4D4D4;"> { </span><span style="color:#569CD6;">get</span><span style="color:#D4D4D4;">; </span><span style="color:#569CD6;">init</span><span style="color:#D4D4D4;">; }</span></span>
<span class="line"><span style="color:#569CD6;">    public</span><span style="color:#4EC9B0;"> DateTime</span><span style="color:#9CDCFE;"> NextAppointment</span><span style="color:#D4D4D4;"> { </span><span style="color:#569CD6;">get</span><span style="color:#D4D4D4;">; </span><span style="color:#569CD6;">set</span><span style="color:#D4D4D4;">; }</span></span>
<span class="line"><span style="color:#6A9955;">    // Additional properties</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D4D4D4;">    [</span><span style="color:#4EC9B0;">DefaultDataSource</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#569CD6;">    public</span><span style="color:#569CD6;"> class</span><span style="color:#4EC9B0;"> PatientDataSource</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">CrudContext</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">AppDbContext</span><span style="color:#D4D4D4;">&gt; </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">) : </span><span style="color:#4EC9B0;">StandardDataSource</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">Patient</span><span style="color:#D4D4D4;">, </span><span style="color:#4EC9B0;">AppDbContext</span><span style="color:#D4D4D4;">&gt;(</span><span style="color:#4EC9B0;">context</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#6A9955;">        // ...</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#569CD6;">    public</span><span style="color:#569CD6;"> class</span><span style="color:#4EC9B0;"> PatientsWithUpcomingAppointmentsDataSource</span><span style="color:#D4D4D4;">(</span><span style="color:#4EC9B0;">CrudContext</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">AppDbContext</span><span style="color:#D4D4D4;">&gt; </span><span style="color:#9CDCFE;">context</span><span style="color:#D4D4D4;">) : </span><span style="color:#4EC9B0;">StandardDataSource</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">Patient</span><span style="color:#D4D4D4;">, </span><span style="color:#4EC9B0;">AppDbContext</span><span style="color:#D4D4D4;">&gt;(</span><span style="color:#4EC9B0;">context</span><span style="color:#D4D4D4;">)</span></span>
<span class="line"><span style="color:#D4D4D4;">    {</span></span>
<span class="line"><span style="color:#D4D4D4;">        [</span><span style="color:#4EC9B0;">Coalesce</span><span style="color:#D4D4D4;">]</span></span>
<span class="line"><span style="color:#569CD6;">        public</span><span style="color:#569CD6;"> int</span><span style="color:#9CDCFE;"> MonthsOut</span><span style="color:#D4D4D4;"> { </span><span style="color:#569CD6;">get</span><span style="color:#D4D4D4;">; </span><span style="color:#569CD6;">set</span><span style="color:#D4D4D4;">; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955;">        // ...</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">}</span></span></code></pre></div><h4 id="without-intellitect-coalesce-swashbuckle" tabindex="-1">Without <code>IntelliTect.Coalesce.Swashbuckle</code> <a class="header-anchor" href="#without-intellitect-coalesce-swashbuckle" aria-label="Permalink to &quot;Without \`IntelliTect.Coalesce.Swashbuckle\`&quot;">​</a></h4><p>In the default OpenAPI configuration, DataSource and Behavior parameters are represented as generic objects. DataSource names are also shown as plain strings, hindering the discoverability of available data sources. <img src="`+o+'" alt=""></p><h4 id="with-intellitect-coalesce-swashbuckle" tabindex="-1">With <code>IntelliTect.Coalesce.Swashbuckle</code> <a class="header-anchor" href="#with-intellitect-coalesce-swashbuckle" aria-label="Permalink to &quot;With `IntelliTect.Coalesce.Swashbuckle`&quot;">​</a></h4><p>With the <code>IntelliTect.Coalesce.Swashbuckle</code> package, OpenAPI can interpret the DataSource as a dropdown menu and provides individual fields for each DataSource property. Additionally, it eliminates unnecessary behavior parameters. <img src="'+l+'" alt=""></p>',24),c=[p];function r(i,D,d,u,y,h){return e(),a("div",null,c)}const m=s(t,[["render",r]]);export{g as __pageData,m as default};
