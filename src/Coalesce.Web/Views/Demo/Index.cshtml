@using IntelliTect.Coalesce.TypeDefinition
@{
    ViewBag.Title = "Demo";
}

<div class="row">
    <div class="col-md-6">
        <h2>Below: Custom View with Coalese</h2>
        <p>The <a href="~/js/demo.index.js">TypeScript that drives this page</a> is just 10 lines:</p>

        <div style="margin-top:15px;">
            Your current role is: @ViewBag.CurrentRole
            <br />
            @if (ViewBag.CurrentRole == "User")
            {
                <span>View the site as an <a href="/Demo/?demoUserRole=Admin">Admin</a></span>
            }
            else
            {
                <span>View the site as a <a href="/Demo/?demoUserRole=User">User</a></span>
            }
        </div>

    </div>
    <div class="col-md-6">
        <h3>See also: Auto-generated Views</h3>
        <p>
            These pages are generated by Coalesce based on your models and data annotations.
            They also contain links to the auto-generated API documentation. Use them as they are, or copy them and make modifications as desired:
        </p>
        <div>
            <span style="width: 50px; display: inline-block">Tables: </span>
            @foreach (var vm in ReflectionRepository.Global.ApiBackedClasses)
            {
                <span>• <a asp-action="Table" asp-controller="@vm.Name" style="padding-right: 15px">@vm.DisplayName</a></span>
            }
        </div>
        <div>
            <span style="width: 50px; display: inline-block">Cards: </span>
            @foreach (var vm in ReflectionRepository.Global.ApiBackedClasses)
            {
                <span>• <a asp-action="Cards" asp-controller="@vm.Name" style="padding-right: 15px">@vm.DisplayName</a></span>
            }
        </div>
    </div>
</div>
<div class="card" style="margin-left: 0; margin-right: 0; margin-top: 20px">
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <span class="label label-info pull-right" style="font-size: 14px" 
                      data-bind="fadeVisible: isLoading">
                    Loading...
                </span>
                <h1 style="margin: 0">
                    Open Cases        
                </h1>
            </div> 
            <div class="col-md-6">
                <a asp-controller="Cases" asp-action="Create" class="btn btn-sm btn-primary pull-right" >
                <i class="fa fa-plus"></i> Log a New Case
                </a>
            </div>
        </div>

        <hr />

        <div class="row">
            <div class="col-md-4">
                <label>
                    Search
                </label>
                <input type="text" value="" data-bind="textInput: search" class="form-control" placeholder="Search" />
            </div>
            <div class="col-md-4">
                <label>
                    Query: Opened After Date
                </label>
                <!-- ko with: dataSource -->
                <div class="input-group date">
                    <input data-bind="datePicker: minDate, format: 'M/D/YYYY h:mm a'" type="text" class="form-control">
                    <span class="input-group-addon">
                        <span class="fa fa-calendar"></span>
                    </span>
                </div>
                <!-- /ko -->
            </div>
            <div class="col-md-4">
                <label style="display: block">
                    Call Server Methods:
                </label>
                <button class="btn btn-primary" data-bind="click: randomizeDatesAndStatus">Randomize Dates & Status</button>
            </div>
        </div>
    </div>
</div>

<div class="flex-card-container" data-bind="foreach: items, visible: isLoaded" style="display: none">
    <div class="flex-card ">
        <div class="card-heading">
            <h3 class="card-title">
                <span data-bind="text: title"></span>
                <i class="pull-right fa fa-times-circle" style="color: red" data-bind="visible: severity() == 'Critical'"></i>
                <i class="pull-right fa fa-exclamation-triangle" style="color: orangered" data-bind="visible: severity() == 'High'"></i>
                <i class="pull-right fa fa-exclamation-circle" style="color: orange" data-bind="visible: severity() == 'Medium'"></i>
                <i class="pull-right fa fa-exclamation" style="color: darkcyan" data-bind="visible: severity() == 'Low'"></i>
            </h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <dl>
                        <dt>Opened at</dt>
                        <dd data-bind="moment: openedAt, format: 'MM/DD/YYYY hh:mm a'"></dd>
                    </dl>
                </div>
                <div class="col-md-6">
                    <a data-bind="click: showEditor" style="cursor: pointer" title="Edit"> <i class="fa fa-pencil"></i> Edit </a>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <dl>
                        <dt>Reported by</dt>
                        <dd data-bind="with: reportedBy"><a data-bind="text: name, attr: {href: '/people/index/' + personId()}"></a></dd>
                    </dl>
                </div>
                <div class="col-md-6">
                    <dl>
                        <dt>Assigned to</dt>
                        <dd data-bind="with: assignedTo"><a data-bind="text: name, attr: {href: '/people/index/' + personId()}"></a></dd>
                    </dl>

                    @* Some tests for dropdowns. *@
                    @*<select data-bind="select2Ajax: assignedToId, object: assignedTo, setObject: true, itemViewModel: ViewModels.Person, idField: 'personId', textField: 'name', url: '/api/person/list'">

                    </select>
                    
                    <select data-bind="select2Ajax: assignedToId, object: assignedTo, setObject: true, itemViewModel: ViewModels.Person, idField: 'personId', textField: 'name', url: '/api/person/list'">

                    </select>
                    <select data-bind="select2Ajax: assignedToId, object: assignedTo, setObject: true, itemViewModel: ViewModels.Person, idField: 'personId', textField: 'name', url: '/api/person/list'">

                    </select>*@
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <dl>
                        <dt>Severity</dt>

                        <dd>
                            <span data-bind="text: severity"></span>
                        </dd>
                    </dl>
                </div>
                <div class="col-md-6">
                    <dl>
                        <dt>Status</dt>
                        <dd data-bind="text: statusText"></dd>
                    </dl>
                </div>
            </div>
            <dl>
                <dt>Products</dt>

                <dd>
                    <ul data-bind="foreach: caseProducts" class="comma-list">
                        <li data-bind="text: product().name"></li>
                    </ul>
                </dd>
            </dl>
            <hr />
            <span data-bind="text: description"></span>
        </div>
    </div>
</div>


@section Scripts{
    <script src="~/js/demo.index.js" asp-append-version="true"></script>
}